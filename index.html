<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>P2P Connect</title>
    <link rel="stylesheet" href="style.css">
</head>
<body data-state="home">

    <!-- HOME -->
    <section id="view-home" class="view">
        <h1>P2P Connect</h1>
        <p class="subtitle">Connect devices directly using QR codes. No server required.</p>
        <div class="name-input-group">
            <input type="text" id="device-name" placeholder="Your name (optional)" autocomplete="off">
            <p class="hint" id="name-preview"></p>
        </div>
        <details class="ice-config-section">
            <summary>
                <span>Network Settings</span>
                <span class="ice-config-badge" id="ice-config-badge">LAN only</span>
            </summary>
            <div class="ice-config-body">
                <p class="ice-config-note">No setup needed if both devices are on the same WiFi. Enable remote connections to connect across different networks.</p>

                <label class="ice-toggle-row">
                    <span>Enable remote connections</span>
                    <span class="toggle-switch">
                        <input type="checkbox" id="ice-remote-toggle">
                        <span class="toggle-slider"></span>
                    </span>
                </label>

                <p class="ice-config-hint hidden" id="ice-remote-hint">Uses free Google STUN and Open Relay TURN servers to connect across the internet. STUN discovers your public address. TURN relays traffic when direct connections are blocked.</p>

                <details class="ice-custom-section">
                    <summary>Custom servers</summary>
                    <div class="ice-custom-body">
                        <p class="ice-config-hint">Add your own STUN or TURN servers. TURN servers require a username and credential. Format: stun:host:port or turn:host:port</p>
                        <div id="ice-custom-list" class="ice-custom-list"></div>
                        <div class="ice-custom-form">
                            <input type="text" id="ice-custom-url" placeholder="stun:host:port or turn:host:port" autocomplete="off">
                            <input type="text" id="ice-custom-username" placeholder="Username (TURN only)" autocomplete="off">
                            <input type="text" id="ice-custom-credential" placeholder="Credential (TURN only)" autocomplete="off">
                            <button id="btn-ice-add-server" class="btn secondary small">Add Server</button>
                        </div>
                    </div>
                </details>
            </div>
        </details>

        <div class="button-group">
            <button id="btn-create" class="btn primary">Create Connection</button>
            <button id="btn-join" class="btn secondary">Join Connection</button>
        </div>
        <div id="reconnect-prompt" class="reconnect-prompt hidden">
            <p>Previous session found</p>
            <p class="hint" id="reconnect-peers-hint"></p>
            <p class="hint">If the other device is showing a QR code, tap "Scan their QR". Otherwise tap "Show my QR" to display a code for them to scan.</p>
            <button id="btn-reconnect-scan" class="btn primary">Scan their QR</button>
            <button id="btn-reconnect-show" class="btn secondary">Show my QR</button>
            <button id="btn-reconnect-dismiss" class="btn secondary small">Start Fresh</button>
        </div>
    </section>

    <!-- CREATING OFFER -->
    <section id="view-creating-offer" class="view">
        <div class="spinner"></div>
        <p>Creating connection offer...</p>
        <p class="hint" id="ice-status">Gathering network candidates...</p>
    </section>

    <!-- SHOW OFFER QR -->
    <section id="view-show-offer-qr" class="view">
        <h2>Show this to the other device</h2>
        <div id="qr-offer" class="qr-container"></div>
        <p class="hint" id="local-ip-display"></p>
        <p class="hint">Other device: tap "Join Connection" and scan this code</p>
        <button id="btn-scan-answer" class="btn primary">Scan their response</button>
    </section>

    <!-- SCAN OFFER (Joiner) -->
    <section id="view-scan-offer" class="view">
        <h2>Scan the offer QR code</h2>
        <div id="scanner-offer" class="scanner-container"></div>
        <button id="btn-cancel-scan-offer" class="btn secondary">Cancel</button>
    </section>

    <!-- CREATING ANSWER -->
    <section id="view-creating-answer" class="view">
        <div class="spinner"></div>
        <p>Creating response...</p>
    </section>

    <!-- SHOW ANSWER QR -->
    <section id="view-show-answer-qr" class="view">
        <h2>Show this to the first device</h2>
        <div id="qr-answer" class="qr-container"></div>
        <p id="subnet-warning"></p>
        <p class="hint">First device: tap "Scan their response"</p>
    </section>

    <!-- SCAN ANSWER (Offerer) -->
    <section id="view-scan-answer" class="view">
        <h2>Scan the response QR code</h2>
        <div id="scanner-answer" class="scanner-container"></div>
        <button id="btn-cancel-scan-answer" class="btn secondary">Cancel</button>
    </section>

    <!-- CONNECTING -->
    <section id="view-connecting" class="view">
        <div class="spinner"></div>
        <p>Establishing connection...</p>
    </section>

    <!-- CONNECTED -->
    <section id="view-connected" class="view connected-view">
        <div class="conn-header">
            <div class="peer-list" id="peer-list"></div>
            <button id="btn-add-peer" class="btn-icon" title="Add Peer">&#x2b;</button>
            <button id="btn-disconnect" class="btn-icon" title="Disconnect">&#x2715;</button>
        </div>

        <div class="tab-bar">
            <button class="tab active" data-tab="messages">Messages</button>
            <button class="tab" data-tab="files">Files</button>
            <button class="tab" data-tab="speed">Speed Test</button>
            <button class="tab" data-tab="datachannel">Data Channel</button>
            <button class="tab" data-tab="media">Media</button>
            <button class="tab" data-tab="network">Network</button>
            <button class="tab" data-tab="stats">Stats</button>
            <button class="tab" data-tab="tools">Tools</button>
        </div>

        <!-- Messages Tab -->
        <div id="tab-messages" class="tab-content active">
            <div id="message-log" class="message-log"></div>
            <div id="typing-indicator" class="typing-indicator hidden"></div>
            <div class="input-bar">
                <button id="btn-camera" class="btn-icon" title="Take Photo">&#x1f4f7;</button>
                <input type="text" id="msg-input" placeholder="Type a message..." autocomplete="off">
                <button id="btn-send-msg" class="btn primary small">Send</button>
            </div>
            <div id="camera-overlay" class="camera-overlay hidden">
                <div class="camera-header">
                    <span>Take Photo</span>
                    <button id="btn-camera-close" class="btn-icon">&#x2715;</button>
                </div>
                <video id="camera-preview" autoplay playsinline></video>
                <canvas id="camera-canvas" class="hidden"></canvas>
                <div class="camera-controls">
                    <button id="btn-camera-switch" class="btn secondary small">Switch</button>
                    <button id="btn-camera-capture" class="btn primary">Capture</button>
                </div>
            </div>
        </div>

        <!-- Files Tab -->
        <div id="tab-files" class="tab-content">
            <div class="peer-selector-bar">
                <label>Send to:</label>
                <select id="file-peer-select" class="peer-select"></select>
            </div>
            <div class="file-controls">
                <label class="btn secondary file-label">
                    Choose File to Send
                    <input type="file" id="file-input" hidden>
                </label>
            </div>
            <div id="file-progress" class="file-progress hidden">
                <p id="file-status"></p>
                <div class="progress-bar"><div class="progress-fill" id="file-progress-fill"></div></div>
            </div>
            <div id="received-files" class="received-files"></div>
        </div>

        <!-- Speed Test Tab -->
        <div id="tab-speed" class="tab-content">
            <div class="peer-selector-bar">
                <label>Test peer:</label>
                <select id="speed-peer-select" class="peer-select"></select>
            </div>
            <div class="speed-controls">
                <button id="btn-quick-test" class="btn primary">Quick Test (1 MB)</button>
                <button id="btn-full-test" class="btn secondary">Full Test Suite</button>
            </div>
            <div id="speed-status" class="speed-status hidden"></div>
            <div id="speed-results" class="speed-results"></div>
        </div>

        <!-- Data Channel Tab -->
        <div id="tab-datachannel" class="tab-content">
            <div class="peer-selector-bar">
                <label>Test peer:</label>
                <select id="dc-peer-select" class="peer-select"></select>
            </div>

            <details class="test-section">
                <summary>Max Message Size</summary>
                <div class="test-section-body">
                    <p class="test-desc">Send increasingly large messages to find the maximum supported size.</p>
                    <div class="test-controls-row">
                        <button id="btn-dc-maxsize" class="btn primary">Run Test</button>
                    </div>
                    <div id="dc-maxsize-results" class="test-results"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>Binary vs Text Throughput</summary>
                <div class="test-section-body">
                    <p class="test-desc">Compare throughput of binary (ArrayBuffer) vs text (JSON string) transfers.</p>
                    <div class="test-controls-row">
                        <button id="btn-dc-bintext" class="btn primary">Run Test</button>
                    </div>
                    <div id="dc-bintext-results" class="test-results"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>Ordered vs Unordered</summary>
                <div class="test-section-body">
                    <p class="test-desc">Compare ordered and unordered data channels — see reordering and speed differences.</p>
                    <div class="test-controls-row">
                        <label>Messages:</label>
                        <input type="number" id="dc-order-count" value="1000" min="100" max="10000">
                        <button id="btn-dc-order" class="btn primary">Run Test</button>
                    </div>
                    <div id="dc-order-results" class="test-results"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>Reliable vs Unreliable</summary>
                <div class="test-section-body">
                    <p class="test-desc">Compare reliable delivery vs unreliable (maxRetransmits=0) channels.</p>
                    <div class="test-controls-row">
                        <label>Messages:</label>
                        <input type="number" id="dc-reliable-count" value="1000" min="100" max="10000">
                        <button id="btn-dc-reliable" class="btn primary">Run Test</button>
                    </div>
                    <div id="dc-reliable-results" class="test-results"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>Stress Test</summary>
                <div class="test-section-body">
                    <p class="test-desc">Flood messages at high rate and measure actual throughput and loss.</p>
                    <div class="test-controls-row">
                        <label>Msgs/sec:</label>
                        <input type="number" id="dc-stress-rate" value="1000" min="100" max="50000">
                        <label>Duration (s):</label>
                        <input type="number" id="dc-stress-duration" value="5" min="1" max="30">
                        <button id="btn-dc-stress" class="btn primary">Run Test</button>
                    </div>
                    <div id="dc-stress-results" class="test-results"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>Concurrent Transfers</summary>
                <div class="test-section-body">
                    <p class="test-desc">Send multiple files on separate data channels simultaneously vs sequentially.</p>
                    <div class="test-controls-row">
                        <label class="btn secondary file-label" style="flex:none;">
                            Choose Files
                            <input type="file" id="dc-concurrent-files" hidden multiple>
                        </label>
                        <button id="btn-dc-concurrent" class="btn primary">Run Test</button>
                    </div>
                    <div id="dc-concurrent-results" class="test-results"></div>
                </div>
            </details>
        </div>

        <!-- Media Tab -->
        <div id="tab-media" class="tab-content">
            <div class="peer-selector-bar">
                <label>Stream with:</label>
                <select id="media-peer-select" class="peer-select"></select>
            </div>
            <div class="media-controls">
                <button id="btn-start-video-audio" class="btn primary">Video + Audio</button>
                <button id="btn-start-video-only" class="btn secondary">Video Only</button>
                <button id="btn-start-audio-only" class="btn secondary">Audio Only</button>
                <button id="btn-stop-media" class="btn danger hidden">Stop</button>
            </div>
            <div class="media-streams">
                <div class="video-wrapper">
                    <video id="local-video" autoplay muted playsinline></video>
                    <span class="video-label">You</span>
                    <button class="btn-fullscreen" id="btn-local-fullscreen" title="Fullscreen">&#x26F6;</button>
                </div>
                <div id="remote-videos" class="remote-videos-container"></div>
            </div>
            <div id="media-stats" class="media-stats hidden">
                <div class="stat-row">
                    <span class="stat-label">Resolution</span>
                    <span class="stat-value" id="stat-resolution">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Framerate</span>
                    <span class="stat-value" id="stat-framerate">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Video bitrate</span>
                    <span class="stat-value" id="stat-video-bitrate">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Audio bitrate</span>
                    <span class="stat-value" id="stat-audio-bitrate">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Packets lost</span>
                    <span class="stat-value" id="stat-packets-lost">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Jitter</span>
                    <span class="stat-value" id="stat-jitter">--</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Round-trip time</span>
                    <span class="stat-value" id="stat-rtt">--</span>
                </div>
            </div>

            <!-- Extended Media Features -->
            <details class="test-section">
                <summary>Codec Detection</summary>
                <div class="test-section-body">
                    <p class="test-desc">Detect supported audio and video codecs in this browser.</p>
                    <div class="test-controls-row">
                        <button id="btn-media-codecs" class="btn primary">Detect Codecs</button>
                    </div>
                    <div id="media-codec-results" class="test-results"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>Screen Sharing</summary>
                <div class="test-section-body">
                    <p class="test-desc">Share your screen with the selected peer.</p>
                    <div class="test-controls-row">
                        <button id="btn-screen-share" class="btn primary">Start Screen Share</button>
                        <button id="btn-screen-stop" class="btn danger hidden">Stop Sharing</button>
                    </div>
                </div>
            </details>

            <details class="test-section">
                <summary>Audio Visualizer</summary>
                <div class="test-section-body">
                    <p class="test-desc">Visualise local and remote audio as frequency bars. Streams are detected automatically — if none are active a placeholder is shown.</p>
                    <div class="test-controls-row">
                        <button id="btn-audio-viz" class="btn primary">Start Visualizer</button>
                        <button id="btn-audio-viz-stop" class="btn danger hidden">Stop</button>
                    </div>
                    <canvas id="audio-visualizer"></canvas>
                </div>
            </details>

            <details class="test-section">
                <summary>Recording</summary>
                <div class="test-section-body">
                    <p class="test-desc">Record the remote media stream to a downloadable file.</p>
                    <div class="test-controls-row">
                        <button id="btn-record-start" class="btn primary">Start Recording</button>
                        <button id="btn-record-stop" class="btn danger hidden">Stop Recording</button>
                    </div>
                    <div id="recording-downloads"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>Resolution Ladder</summary>
                <div class="test-section-body">
                    <p class="test-desc">Step through resolutions and measure actual quality at each step.</p>
                    <div class="test-controls-row">
                        <button id="btn-res-ladder" class="btn primary">Run Ladder Test</button>
                    </div>
                    <div id="res-ladder-results" class="test-results"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>Bandwidth Adaptation</summary>
                <div class="test-section-body">
                    <p class="test-desc">Constrain video bitrate and observe adaptation.</p>
                    <div class="test-controls-row">
                        <label>Max bitrate (kbps):</label>
                        <input type="number" id="bw-limit" value="500" min="50" max="10000">
                        <button id="btn-bw-apply" class="btn primary">Apply</button>
                        <button id="btn-bw-remove" class="btn secondary">Remove Limit</button>
                    </div>
                    <div id="bw-results" class="test-results"></div>
                </div>
            </details>
        </div>

        <!-- Network Tab -->
        <div id="tab-network" class="tab-content">
            <div class="network-viz">
                <canvas id="mesh-canvas" width="400" height="300"></canvas>
            </div>
            <div class="traffic-stats">
                <h3>Peer Statistics</h3>
                <table id="traffic-table" class="traffic-table">
                    <thead>
                        <tr>
                            <th>Peer</th>
                            <th>State</th>
                            <th>Msgs Sent</th>
                            <th>Msgs Recv</th>
                            <th>Bytes Sent</th>
                            <th>Bytes Recv</th>
                        </tr>
                    </thead>
                    <tbody id="traffic-tbody"></tbody>
                </table>
            </div>

            <!-- Extended Network Tests -->
            <details class="test-section">
                <summary>ICE Candidate Inspector</summary>
                <div class="test-section-body">
                    <p class="test-desc">Gather and inspect local ICE candidates to see your network interfaces.</p>
                    <div class="test-controls-row">
                        <button id="btn-ice-gather" class="btn primary">Gather Candidates</button>
                    </div>
                    <div id="ice-candidates-results" class="test-results"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>Connection Type Detection</summary>
                <div class="test-section-body">
                    <p class="test-desc">Detect connection type (direct/relay), protocol (UDP/TCP), and addresses for a peer.</p>
                    <div class="test-controls-row">
                        <label>Peer:</label>
                        <select id="conntype-peer-select" class="peer-select"></select>
                        <button id="btn-conntype" class="btn primary">Detect</button>
                    </div>
                    <div id="conntype-results" class="test-results"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>STUN/TURN Testing</summary>
                <div class="test-section-body">
                    <p class="test-desc">Test reachability of STUN/TURN servers.</p>
                    <div class="test-controls-row">
                        <input type="text" id="stun-url" value="stun:stun.l.google.com:19302" style="width:200px;">
                        <button id="btn-stun-test" class="btn primary">Test Server</button>
                    </div>
                    <div id="stun-results" class="test-results"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>MTU Discovery</summary>
                <div class="test-section-body">
                    <p class="test-desc">Find the effective maximum transmission unit by sending increasing-size messages.</p>
                    <div class="test-controls-row">
                        <label>Peer:</label>
                        <select id="mtu-peer-select" class="peer-select"></select>
                        <button id="btn-mtu" class="btn primary">Discover MTU</button>
                    </div>
                    <div id="mtu-results" class="test-results"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>ICE Restart Test</summary>
                <div class="test-section-body">
                    <p class="test-desc">Trigger an ICE restart and measure recovery time.</p>
                    <div class="test-controls-row">
                        <label>Peer:</label>
                        <select id="restart-peer-select" class="peer-select"></select>
                        <button id="btn-ice-restart" class="btn primary">Restart ICE</button>
                    </div>
                    <div id="restart-results" class="test-results"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>Packet Loss / Jitter Simulation</summary>
                <div class="test-section-body">
                    <p class="test-desc">Simulate packet loss and jitter on incoming messages (local only).</p>
                    <div class="test-controls-row">
                        <label>Loss %:</label>
                        <input type="number" id="sim-loss" value="10" min="0" max="100">
                        <label>Jitter (ms):</label>
                        <input type="number" id="sim-jitter" value="50" min="0" max="2000">
                        <button id="btn-sim-enable" class="btn primary">Enable</button>
                        <button id="btn-sim-disable" class="btn danger hidden">Disable</button>
                    </div>
                    <div id="sim-results" class="test-results"></div>
                </div>
            </details>
        </div>

        <!-- Stats Tab -->
        <div id="tab-stats" class="tab-content">
            <div class="peer-selector-bar">
                <label>Peer:</label>
                <select id="stats-peer-select" class="peer-select"></select>
            </div>
            <div class="stats-controls">
                <button id="btn-stats-start" class="btn primary">Start</button>
                <button id="btn-stats-stop" class="btn danger hidden">Stop</button>
                <label><input type="checkbox" id="stats-autoscroll" checked> Auto-scroll</label>
                <select id="stats-type-filter" class="stats-filter">
                    <option value="">All Types</option>
                    <option value="candidate-pair">candidate-pair</option>
                    <option value="inbound-rtp">inbound-rtp</option>
                    <option value="outbound-rtp">outbound-rtp</option>
                    <option value="remote-inbound-rtp">remote-inbound-rtp</option>
                    <option value="local-candidate">local-candidate</option>
                    <option value="remote-candidate">remote-candidate</option>
                    <option value="transport">transport</option>
                    <option value="codec">codec</option>
                    <option value="data-channel">data-channel</option>
                </select>
            </div>
            <div id="stats-dump" class="stats-dump"></div>
        </div>

        <!-- Tools Tab -->
        <div id="tab-tools" class="tab-content">
            <details class="test-section" open>
                <summary>Encryption Verification</summary>
                <div class="test-section-body">
                    <p class="test-desc">Compare DTLS fingerprints to verify end-to-end encryption.</p>
                    <div class="test-controls-row">
                        <label>Peer:</label>
                        <select id="encrypt-peer-select" class="peer-select"></select>
                        <button id="btn-encrypt-verify" class="btn primary">Verify</button>
                    </div>
                    <div id="encrypt-results" class="test-results"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>Clipboard Sync</summary>
                <div class="test-section-body">
                    <p class="test-desc">Send clipboard text to all connected peers.</p>
                    <div class="test-controls-row">
                        <button id="btn-clipboard-send" class="btn primary">Send Clipboard</button>
                    </div>
                    <div id="clipboard-received"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>Geolocation Sharing</summary>
                <div class="test-section-body">
                    <p class="test-desc">Share your GPS coordinates with peers and calculate distances.</p>
                    <div class="test-controls-row">
                        <button id="btn-geo-share" class="btn primary">Share Location</button>
                    </div>
                    <div id="geo-results" class="test-results"></div>
                </div>
            </details>

            <details class="test-section">
                <summary>Shared Whiteboard</summary>
                <div class="test-section-body">
                    <div class="test-controls-row">
                        <input type="color" id="wb-color" value="#2563eb">
                        <label>Size:</label>
                        <input type="number" id="wb-size" value="3" min="1" max="20">
                        <button id="btn-wb-clear" class="btn secondary">Clear</button>
                    </div>
                    <canvas id="whiteboard-canvas" width="600" height="300"></canvas>
                </div>
            </details>

            <details class="test-section">
                <summary>Remote Control</summary>
                <div class="test-section-body">
                    <p class="test-desc">Control this page on a remote device — cursor, clicks,
                        scrolling and key presses are forwarded in real time over the data channel.</p>
                    <div class="test-controls-row">
                        <label>Control:</label>
                        <select id="rc-peer-select" class="peer-select"></select>
                        <button id="btn-rc-start" class="btn primary">Start Controlling</button>
                        <button id="btn-rc-stop" class="btn danger hidden">Stop</button>
                    </div>
                    <p id="rc-status" class="hint"></p>
                </div>
            </details>

            <details class="test-section">
                <summary>Sensor Streaming</summary>
                <div class="test-section-body">
                    <p class="test-desc">Stream device accelerometer and gyroscope data to peers.</p>
                    <div class="test-controls-row">
                        <button id="btn-sensor-start" class="btn primary">Start Streaming</button>
                        <button id="btn-sensor-stop" class="btn danger hidden">Stop</button>
                    </div>
                    <div id="sensor-results" class="test-results"></div>
                </div>
            </details>
        </div>
    </section>

    <!-- ADD PEER MODAL -->
    <div id="add-peer-modal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h2>Add Peer</h2>
                <button id="btn-close-modal" class="btn-icon">&#x2715;</button>
            </div>
            <div class="modal-body">
                <div id="modal-home" class="modal-step">
                    <button id="modal-btn-create" class="btn primary">Create Connection</button>
                    <button id="modal-btn-join" class="btn secondary">Join Connection</button>
                </div>
                <div id="modal-creating" class="modal-step hidden">
                    <div class="spinner"></div>
                    <p>Creating connection...</p>
                </div>
                <div id="modal-show-offer" class="modal-step hidden">
                    <div id="modal-qr-offer" class="qr-container"></div>
                    <p class="hint" id="modal-local-ip-display"></p>
                    <p class="hint">Other device: scan this code</p>
                    <button id="modal-btn-scan-answer" class="btn primary">Scan their response</button>
                </div>
                <div id="modal-scan-offer" class="modal-step hidden">
                    <div id="modal-scanner-offer" class="scanner-container"></div>
                    <button id="modal-btn-cancel-scan" class="btn secondary">Cancel</button>
                </div>
                <div id="modal-creating-answer" class="modal-step hidden">
                    <div class="spinner"></div>
                    <p>Creating response...</p>
                </div>
                <div id="modal-show-answer" class="modal-step hidden">
                    <div id="modal-qr-answer" class="qr-container"></div>
                    <p id="modal-subnet-warning"></p>
                    <p class="hint">First device: scan this response</p>
                </div>
                <div id="modal-scan-answer" class="modal-step hidden">
                    <div id="modal-scanner-answer" class="scanner-container"></div>
                    <button id="modal-btn-cancel-scan-answer" class="btn secondary">Cancel</button>
                </div>
                <div id="modal-connecting" class="modal-step hidden">
                    <div class="spinner"></div>
                    <p>Connecting...</p>
                </div>
                <div id="modal-reconnect" class="modal-step hidden">
                    <p id="modal-reconnect-peer-name"></p>
                    <div id="modal-reconnect-qr" class="qr-container"></div>
                    <p class="hint">Show this QR to the other device. Ask them to tap "Scan their QR" on the reconnect screen. Once they show you a QR, tap "Scan their response".</p>
                    <p class="reconnect-countdown" id="modal-reconnect-countdown"></p>
                    <button id="modal-btn-reconnect-scan" class="btn primary">Scan their response</button>
                    <button id="modal-btn-reconnect-cancel" class="btn secondary small">Give up</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ERROR -->
    <section id="view-error" class="view">
        <h2>Something went wrong</h2>
        <p id="error-message" class="error-text"></p>
        <button id="btn-retry" class="btn primary">Try Again</button>
    </section>

    <div id="rc-controlled-banner" class="hidden"></div>
    <div id="rc-ghost-cursor"      class="hidden" aria-hidden="true"></div>

    <!-- CDN Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <!-- App modules -->
    <script src="signal.js"></script>
    <script src="qr.js"></script>
    <script src="peer.js"></script>
    <script src="speedtest.js"></script>
    <script src="stats-explorer.js"></script>
    <script src="datachannel-tests.js"></script>
    <script src="network-tests.js"></script>
    <script src="media-extended.js"></script>
    <script src="tools.js"></script>
    <script src="ice-config.js"></script>
    <script src="app.js"></script>
</body>
</html>
